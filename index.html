<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Startpage</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <img title='Click to edit config or press C' src="https://archlinux.org/static/logos/archlinux-logo-light-scalable.svg" alt="logo" id='logo' onclick='toggleModal()'>
  <div class="searchbar">
    <input type="text" id='searchbar'>
    <img src="./search.svg" id='search' alt="" onclick=searchq(search.value)>
  </div>
  <div class="links-wrap"> 
    <div class="links" id='links'> 
    </div>
  </div>
  <div class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h1>Config editor</h1>
        <span onclick='toggleModal()'><h1>X</h1></span>
      </div>
      <div class="modal-content">
        <div class="links-edit edit-block">
          <h1>Links</h1>
            <textarea name="links" id="links-edit" class='editor' placeholder="[{'name': name, 'url': url}]"></textarea>
        </div>
        <div class="logo-edit edit-block">
          <h1>Logo link</h1>
          <textarea name="links" id="logo-edit" class='editor' placeholder='Link to picture'></textarea>
        </div>
        <div class="search-edit edit-block">
          <h1>Search query link</h1>
          <textarea name="searchQuery" id="sq-edit" class='editor' placeholder='DuckDuckGo: https://duckduckgo.com/search?q=
Google: https://google.com/search?q=
Yandex: https://yandex.ru/search?text='></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button id='apply' onclick='applyCfg()'>Apply</button>
      </div>
    </div>
  </div>
  <script>
    const links = document.getElementById('links');
    const logo = document.getElementById('logo');
    const search = document.getElementById('searchbar');
    const searchbtn = document.getElementById('search');
    const linksEdit = document.getElementById('links-edit');
    const logoEdit = document.getElementById('logo-edit');
    const sqEdit = document.getElementById('sq-edit');
    const applyBtn = document.getElementById('apply');
    const modal = document.querySelector('.modal-overlay');
    let defaultLinks = [
      {'name': 'YouTube', url: 'https://youtube.com'},
      {'name': 'Reddit', url: 'https://reddit.com'},
      {'name': 'Deepseek', url: 'https://chat.deepseek.com'},
      {'name': 'Discord', url: 'https://discord.com/channels/@me'},
    ] 
    const d = new Date();
    d.setTime(d.getTime() + (1000*24*60*60*1000));
    let expires = "expires=" + d.toUTCString();
    if (!getCookie('links')){
      document.cookie = 'links=' + JSON.stringify(defaultLinks) + ';expires=31 December 2040;';
    };
    if (!getCookie('logo_url')){
      document.cookie = 'logo_url=' + logo.src + ';expires=31 December 2040';
    } else {
      logo.src = getCookie('logo_url');
    };
    if (!getCookie('searchQuery')){
      document.cookie = 'searchQuery=https://duckduckgo.com/search?q=;expires=31 December 2040;';
    };
    function getCookie(cname) {
      let name = cname + "=";
      let ca = document.cookie.split(';');
      for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) == 0) {
        return c.substring(name.length, c.length);
      }}}
    let linksc = JSON.parse(getCookie('links'));
    linksEdit.value = JSON.stringify(linksc);
    logoEdit.value = getCookie('logo_url');
    sqEdit.value = getCookie('searchQuery');

    linksc.forEach((bookmark, index) => {
                links.innerHTML += `
                   <div class="link">
                     <a href="${bookmark.url}">
                       <img src='https://favicon.is/${bookmark.url.slice(8)}' alt="" class='link-img'>
                       <h1>${bookmark.name}</h1>
                      </a>
                   </div> 
                    `;});

    function searchq(value){
      window.location.href = getCookie('searchQuery') + value;
    }

    document.addEventListener('keypress', (key) => {
      if (key.key == 'Enter'){
        searchq(search.value);
      }
      if (key.key == 'c' && document.activeElement != search){
        toggleModal();
      }
    }); 
 
    function toggleModal(){
      if (modal.style.display == 'none'){
        modal.style.display = 'flex';
      } else {
        modal.style.display = 'none';
      }
    }

    function applyCfg(){
      if (linksEdit.value != '' && logoEdit.value != '' && sqEdit.value != ''){
        document.cookie = 'links=' + linksEdit.value + ';expires=31 December 2040;';
        document.cookie = 'logo_url=' + logoEdit.value + ';expires=31 December 2040;';
        document.cookie = 'searchQuery=' + sqEdit.value + ';expires=31 December 2040;';
 
        applyBtn.innerHTML = 'Applied';
        setTimeout(() => {applyBtn.innerHTML='Apply'}, 1500);
      } 
    }

    //console.log(linksc);
    //console.log(defaultLinks)
  </script>
</body>
</html>
